spring.application.name=tanaye_back
spring.config.import=optional:classpath:application-local.properties

server.port=${PORT:9999}
server.address=0.0.0.0

# Configuration de la base de données (utilise les variables d'environnement ou application-local.properties)
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/tanaye_back}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.fetch_size=25

# PostgreSQL: Configuration du dialecte et désactivation du cache
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=true
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false


# JWT Configuration
jwt.secret=${JWT_SECRET:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970337336763979244226452948404D635166546A576E5A7234753778214125442A}
jwt.expiration=${JWT_EXPIRATION:86400000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# Security Configuration
security.max-login-attempts=5
security.account-lockout-duration=30
app.cors.allowed-origins=${APP_CORS_ALLOWED_ORIGINS:http://localhost:4200,http://localhost:3000}

# Enable scheduling for token cleanup
spring.task.scheduling.pool.size=1

# Hikari Connection Pool (optimized for low memory)
spring.datasource.hikari.maximum-pool-size=3
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.leak-detection-threshold=60000

# PostgreSQL: Désactiver le cache des prepared statements
spring.datasource.hikari.data-source-properties.prepareThreshold=0
spring.datasource.hikari.data-source-properties.preparedStatementCacheQueries=0
spring.datasource.hikari.data-source-properties.preparedStatementCacheSizeMiB=0

# Upload configuration
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=60MB
storage.root=uploads

# ===== CONFIGURATION SUPABASE STORAGE =====
app.storage.supabase.url=${SUPABASE_URL:https://hdexxoihbyppkoderaso.supabase.co}
app.storage.supabase.bucket=${SUPABASE_BUCKET:products}
app.storage.supabase.service-role-key=${SUPABASE_SERVICE_ROLE_KEY:}

# ===== CONFIGURATION EMAIL =====
# Provider: brevo
app.mail.provider=${APP_MAIL_PROVIDER:brevo}
app.mail.from=${APP_MAIL_FROM:amadoulandoure004@gmail.com}

# Configuration Brevo (utilisée si app.mail.provider=brevo)
app.mail.brevo.api-key=${BREVO_API_KEY:}

# Admin emails for weekly suspicious report (comma-separated)
app.admin.emails=${APP_ADMIN_EMAILS:}

# OAuth2 Configuration (Google)
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.scope=email,profile
spring.security.oauth2.client.registration.google.redirect-uri=${APP_BASE_URL:http://localhost:9999}/api/auth/oauth2/callback/google
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v3/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=sub

# Base URL for redirects
app.base-url=${APP_BASE_URL:http://localhost:9999}
app.frontend-url=${APP_FRONTEND_URL:https://tanaye.vercel.app}
